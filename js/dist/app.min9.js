var landmarks=[{title:"The Sphinx",location:{lat:29.9753,lng:31.1376},country:"Egypt",city:"Cairo"},{title:"Angkor Wat",location:{lat:13.4119,lng:103.8642},country:"Cambodia",city:"Phnom_Penh"},{title:"Christ the Redeemer",location:{lat:-22.9519,lng:-43.2105},country:"Brazil",city:"Rio_de_Janeiro"},{title:"Eiffel Tower",location:{lat:48.8584,lng:2.2945},country:"France",city:"Paris"},{title:"Statue of Liberty",location:{lat:40.6892,lng:-74.0445},country:"NY",city:"New_York"},{title:"Kaaba",location:{lat:21.4225,lng:39.8262},country:"Saudi_Arabia",city:"Mecca"},{title:"Taj Mahal",location:{lat:27.175,lng:78.0422},country:"India",city:"Dharmapuri"},{title:"Colosseum",location:{lat:41.8902,lng:12.4922},country:"Italy",city:"Rome"},{title:"El Castillo",location:{lat:20.683,lng:-88.5686},country:"Mexico",city:"Yucatan"},{title:"Golden Gate Bridge",location:{lat:37.8199,lng:-122.4804},country:"CA",city:"San_Francisco"},{title:"Great Wall of China",location:{lat:40.4319,lng:116.5704},country:"China",city:"Beijing"},{title:"Sydney Opera House",location:{lat:-33.8568,lng:151.2153},country:"Australia",city:"Sydney"},{title:"Mount Rushmore",location:{lat:43.8791,lng:-103.4591},country:"SD",city:"Keystone"},{title:"Hagia Sophia",location:{lat:41.0086,lng:28.9802},country:"Turkey",city:"Sultanahmet"}],Marker=function(e,t){var a=this;this.makeMarkerIcon=function(e){var t=new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+e+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34));return t},this.position=e.location,this.title=e.title;var o=this.makeMarkerIcon("FF0000"),i=this.makeMarkerIcon("FFFF24"),r=new google.maps.Marker({position:a.position,title:a.title,animation:google.maps.Animation.DROP,icon:o,id:e});return r.isVisible=ko.observable(!1),r.isVisible.subscribe(function(e){e?r.setVisible(!0):r.setVisible(!1)}),r.isVisible(!0),r.addListener("mouseover",function(){this.setIcon(i)}),r.addListener("mouseout",function(){this.setIcon(o)}),r},ViewModel=function(){var e=this;this.initMap=function(){var t=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2e5d4"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#c5dac6"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{lightness:20}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#c5c6c6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#e4d7c6"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#fbfaf7"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{color:"#acbcc9"}]}];e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},styles:t,zoom:12,mapTypeControl:!1})},this.initApp=function(){this.landmarkList=ko.observableArray(landmarks),this.query=ko.observable(""),this.initMap(),this.initMarkers(),this.searchResultsForLandmarks=ko.computed(function(){var t=e.query();return e.landmarkList().filter(function(e){return e.title.toLowerCase().indexOf(t.toLowerCase())>=0})}),this.searchResultsForMarkers=ko.computed(function(){var t=e.query().toLowerCase();return ko.utils.arrayFilter(e.landmarkList(),function(e){var a=e.marker.title.toLowerCase().indexOf(t)>=0;return e.marker.isVisible(a),a})}),this.currentMarker=ko.observable(),this.infoWindow=new google.maps.InfoWindow},this.initMarkers=function(){var t=e.map,a=new google.maps.LatLngBounds;e.landmarkList().forEach(function(o){o.marker=new Marker(o,t),o.marker.setMap(t),a.extend(o.marker.position),google.maps.event.addDomListener(window,"resize",function(){t.fitBounds(a)}),o.marker.addListener("click",function(){e.setAsCurrentMarker(o)})}),e.map.fitBounds(a)},this.setAsCurrentMarker=function(t){if(e.landmarkList().forEach(function(e){e.marker.setAnimation(null)}),t!=e.currentMarker()){t.marker.setMap(e.map);var a=t.location.lng,o=t.location.lat;if(o>46)var i=82;else if(o>40)var i=o+38;else if(o>20)var i=o+42;else if(o>-10)var i=o+56;else var i=o+74;var r={lat:i,lng:a};e.map.setCenter(r),t.marker.setAnimation(google.maps.Animation.BOUNCE),e.currentLandmark=ko.observable(t.marker),e.populateInfoWindow(t,e.infoWindow)}},this.populateInfoWindow=function(t,a){function o(e,t){if(t==google.maps.StreetViewStatus.OK){var a=e.location.latLng,o=google.maps.geometry.spherical.computeHeading(a,i.position),r={position:a,pov:{heading:o,pitch:10},addressControl:!1,panControl:!1};new google.maps.StreetViewPanorama(document.getElementById("pano"),r)}else $("#pano").html("Error: No street view found.")}var i=t.marker;if(a.marker!=i){a.setContent(""),a.marker=i,a.addListener("closeclick",function(){a.marker=null,i.setAnimation(null)}),a.setContent('<div class="marker-div"><h2 class="marker-title">'+i.title+'</h2><div id="pano"></div><div class="weather-div"><h3 class="weather-conditions"></h3><h3 class="weather-temperature"></h3></div></div>');var r="https://api.wunderground.com/api/6878610c92332316/conditions/q/"+t.country+"/"+t.city+".json";$.ajax({url:r,success:function(e){""===e.current_observation.weather?$(".weather-conditions").html("Error: Weather currently unavailable."):($(".weather-conditions").html(e.current_observation.weather),$(".weather-temperature").html(e.current_observation.temperature_string))},error:function(){$(".weather-conditions").html("Error: Weather failed to load.")}});var n=new google.maps.StreetViewService,l=50;n.getPanoramaByLocation(i.position,l,o),a.open(e.map,i)}},this.toggleHamburger=function(){$("#nav-list").animate({width:"toggle"},350)},this.initApp()},mapsUrl="https://maps.googleapis.com/maps/api/js?key=AIzaSyD12rqNI0xx-o1LXAxtJ-X-Es30h_oS6j4&v=3";$.getScript(mapsUrl).done(function(){ko.applyBindings(new ViewModel)}).fail(function(){alert("Error: Map failed to load. Please reload page.")});