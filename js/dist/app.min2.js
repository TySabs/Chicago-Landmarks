var landmarks=[{title:"The Sphinx",location:{lat:29.9753,lng:31.1376},country:"Egypt",city:"Cairo"},{title:"Angkor Wat",location:{lat:13.4119,lng:103.8642},country:"Cambodia",city:"Phnom_Penh"},{title:"Christ the Redeemer",location:{lat:-22.9519,lng:-43.2105},country:"Brazil",city:"Rio_de_Janeiro"},{title:"Eiffel Tower",location:{lat:48.8584,lng:2.2945},country:"France",city:"Paris"},{title:"Statue of Liberty",location:{lat:40.6892,lng:-74.0445},country:"NY",city:"New_York"},{title:"Kaaba",location:{lat:21.4225,lng:39.8262},country:"Saudi_Arabia",city:"Mecca"},{title:"Taj Mahal",location:{lat:27.175,lng:78.0422},country:"India",city:"Dharmapuri"},{title:"Colosseum",location:{lat:41.8902,lng:12.4922},country:"Italy",city:"Rome"},{title:"El Castillo",location:{lat:20.683,lng:-88.5686},country:"Mexico",city:"Yucatan"},{title:"Golden Gate Bridge",location:{lat:37.8199,lng:-122.4804},country:"CA",city:"San_Francisco"},{title:"Great Wall of China",location:{lat:40.4319,lng:116.5704},country:"China",city:"Beijing"},{title:"Sydney Opera House",location:{lat:-33.8568,lng:151.2153},country:"Australia",city:"Sydney"},{title:"Mount Rushmore",location:{lat:43.8791,lng:-103.4591},country:"SD",city:"Keystone"},{title:"Hagia Sophia",location:{lat:41.0086,lng:28.9802},country:"Turkey",city:"Sultanahmet"}],Marker=function(e,t){var a=this;this.makeMarkerIcon=function(e){var t=new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+e+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34));return t},this.position=ko.observable(e.location),this.title=ko.observable(e.title);var i=this.makeMarkerIcon("FF0000"),o=this.makeMarkerIcon("FFFF24"),r=new google.maps.Marker({position:a.position(),title:a.title(),animation:google.maps.Animation.DROP,icon:i,id:e});return r.isVisible=ko.observable(!1),r.isVisible.subscribe(function(e){e?r.setMap(t):r.setMap(null)}),r.isVisible(!0),r.addListener("mouseover",function(){this.setIcon(o)}),r.addListener("mouseout",function(){this.setIcon(i)}),r},ViewModel=function(){var e=this;this.initMap=function(){var t=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2e5d4"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#c5dac6"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{lightness:20}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#c5c6c6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#e4d7c6"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#fbfaf7"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{color:"#acbcc9"}]}];e.map=new google.maps.Map(document.getElementById("map"),{center:{lat:41.8789,lng:-87.6359},styles:t,zoom:12,mapTypeControl:!1})},this.initHamburger=function(){$("#nav-hamburger").on("click",function(){var e=$($(this).data("target"));e.animate({width:"toggle"},350)})},this.initApp=function(){this.landmarkList=ko.observableArray(landmarks),this.query=ko.observable(""),this.initMap(),this.initHamburger(),this.initMarkers(),this.searchResultsForLandmarks=ko.computed(function(){var t=e.query();return e.landmarkList().filter(function(e){return e.title.toLowerCase().indexOf(t.toLowerCase())>=0})}),this.searchResultsForMarkers=ko.computed(function(){var t=e.query().toLowerCase();return ko.utils.arrayFilter(e.landmarkList(),function(e){var a=e.marker.title.toLowerCase().indexOf(t)>=0;return e.marker.isVisible(a),a})}),this.currentMarker=ko.observable();var t=new google.maps.InfoWindow;this.infoWindow=ko.observable(t),this.infoWindowState=ko.observable("IL"),this.infoWindowCity=ko.observable("Chicago"),this.weatherConditions=ko.observable(""),this.weatherTemperature=ko.observable("")},this.initMarkers=function(){var t=e.map,a=new google.maps.LatLngBounds;e.landmarkList().forEach(function(i){i.marker=new Marker(i,t),i.marker.setMap(t),a.extend(i.marker.position),i.marker.addListener("click",function(){e.setAsCurrentMarker(i)})}),e.map.fitBounds(a)},this.setAsCurrentMarker=function(t){if(e.landmarkList().forEach(function(e){e.marker.setAnimation(null)}),t!=e.currentMarker()){t.marker.setMap(e.map);var a=t.location.lng,i=t.location.lat;if(i>46)var o=89;else if(i>40)var o=i+41;else if(i>20)var o=i+54;else if(i>-10)var o=i+68;else var o=i+90;var r={lat:o,lng:a};e.map.setCenter(r),t.marker.setAnimation(google.maps.Animation.BOUNCE),e.currentLandmark=ko.observable(t.marker),e.populateInfoWindow(t,e.infoWindow())}},this.populateInfoWindow=function(t,a){function i(e,i){if(i==google.maps.StreetViewStatus.OK){var r=e.location.latLng,n=google.maps.geometry.spherical.computeHeading(r,o.position),l='<h3 class="weather-conditions"></h3>',s='<h3 class="weather-temperature"></h3>';a.setContent('<div class="marker-div" data-bind="with: $root.currentMarker"><h2 class="marker-title">'+o.title+'</h2><div id="pano"></div><div class="weather-div">'+l+s+"</div></div>");var c="https://api.wunderground.com/api/6878610c92332316/conditions/q/"+t.country+"/"+t.city+".json";$.ajax({url:c,success:function(e){if(""===e.current_observation.weather)$(".weather-conditions").html("Error: Weather currently unavailable.");else{var t=e.current_observation.weather+" - ";$(".weather-conditions").html(t),$(".weather-temperature").html(e.current_observation.temperature_string)}},error:function(){$(".weather-conditions").html("Error: Weather failed to load.")}});var u={position:r,pov:{heading:n,pitch:10},addressControl:!1,panControl:!1};new google.maps.StreetViewPanorama(document.getElementById("pano"),u)}else a.setContent("<div>"+o.title+"</div><div>No Street View Found</div>")}var o=t.marker;if(a.marker!=o){a.setContent(""),a.marker=o,a.addListener("closeclick",function(){a.marker=null,o.setAnimation(null)});var r=new google.maps.StreetViewService,n=50;r.getPanoramaByLocation(o.position,n,i),a.open(e.map,o)}},this.initApp()};ko.applyBindings(new ViewModel);